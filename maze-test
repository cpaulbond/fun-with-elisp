#!/usr/bin/env emacs -script
;;; -*- lexical-binding: t -*-
;;> Simple maze generator.
;;> Example: ./maze-generate 20 20

(add-to-list 'load-path (file-name-directory load-file-name))
(require 'cl-lib)
(require 'maze)


(defun clear-maze-visited (m)
  (let ((rows (1- (maze-rows m)))
        (cols (1- (maze-cols m))))

    (dotimes (r rows)
      (dotimes (c cols)
        (maze-unset m r c 'visited)))))


(let* ((rows 12)
       (cols 24)
       (file-name "maze.tmp")
       (a (new-maze rows cols))
       b)
  
  (dig-maze-non-recursive a (random rows) (random cols))
  (with-temp-file file-name
    (let ((standard-output (current-buffer)))
      (print-maze a)))

  (clear-maze-visited a)
  (setq b (read-maze file-name))

  (princ (format "(equal a b) %s\n" (equal a b)))
  (dump-maze a)
  (dump-maze b))

